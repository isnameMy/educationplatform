<!-- src/templates/student/dashboard.html -->
{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2>{{ course.title }}</h2>
    <p class="text-muted">{{ course.description }}</p>
  </div>
  <span class="badge bg-success fs-5">{{ progress }} / {{ total }}</span>
</div>

<!-- Кнопка "Изучить материал" -->
<div class="card card-hover mb-4">
  <div class="card-body text-center">
    <a href="/student/course/{{ course.id }}/material" class="btn btn-primary btn-lg btn-grad text-white">
  <i class="bi bi-book me-2"></i> Изучить материал курса
</a>
  </div>
</div>

<!-- Прогресс -->
<div class="card card-hover mb-4">
  <div class="card-body">
    <div class="d-flex justify-content-between mb-2">
      <strong>Ваш прогресс</strong>
      <span>{{ (progress / total * 100) | round(1) if total > 0 else 0 }}%</span>
    </div>
    <div class="progress" style="height: 12px;">
      <div 
        class="progress-bar" 
        role="progressbar" 
        style="width: {{ (progress / total * 100) if total > 0 else 0 }}%">
      </div>
    </div>
  </div>
</div>

<!-- Рекомендации -->
{% if recommendations %}
<div class="card card-hover mb-4" style="background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%); color: white;">
  <div class="card-body">
    <h5 class="mb-3"><i class="bi bi-stars me-2"></i> Персональные рекомендации</h5>
    {% for rec in recommendations %}
    <div class="d-flex align-items-start mb-3 pb-2 border-bottom border-white-50">
      <div class="me-3 mt-1">
        <span class="badge bg-light text-dark">✨</span>
      </div>
      <div>
        <h6 class="mb-1">{{ rec.title }}</h6>
        <p class="mb-0 opacity-75">{{ rec.reason }}</p>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<!-- Задания -->
<h4>Список заданий</h4>
<div class="row">
  {% for assignment in assignments %}
  <div class="col-md-6 mb-4">
    <div class="card card-hover h-100">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">{{ assignment.title }}</h5>
        <p class="card-text text-muted flex-grow-1">{{ assignment.description }}</p>

        {% set submission = submissions.get(assignment.id) %}
        <div class="mt-auto">
          {% if not submission %}
            <a href="/student/assignment/{{ assignment.id }}" class="btn btn-primary w-100">
              <i class="bi bi-play-circle me-2"></i> Начать
            </a>
          {% elif submission.status == "pending" %}
            <div class="d-flex align-items-center">
              <span class="badge bg-warning text-dark me-2">⏳ На проверке</span>
              <small>{{ submission.submitted_at.strftime('%d.%m') }}</small>
            </div>
          {% elif submission.status == "reviewed" %}
            <div>
              <span class="badge bg-success me-2">✅ Проверено</span>
              <strong>{{ submission.grade }}/10</strong>
            </div>
            {% if submission.feedback %}
            <p class="mt-2 mb-0 text-muted small">«{{ submission.feedback[:60] }}...»</p>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% endblock %}