version: '3.8' # Версия синтаксиса docker-compose

services:
  # Сервис бэкенда (FastAPI)
  backend:
    # Указывает, что образ нужно собрать из Dockerfile в текущей директории
    build: .
    # Пробрасываем порт 8000 внутреннего контейнера на порт 8000 локального компьютера
    ports:
      - "8000:8000"
    # Монтируем том для хранения загруженных файлов (uploads/)
    # Это позволяет файлам, сохранённым в контейнере, оставаться доступными после его перезапуска
    volumes:
      # Том для папки uploads (хранение файлов студентов)
      - uploads_volume:/app/uploads
      # (Опционально) Монтируем код для hot-reload (удобно при разработке)
      # Закомментируй эту строку, если не хочешь монтировать код (для продакшена)
      # - .:/app
      # Исключаем виртуальное окружение, кэш и git из монтирования
      # - /app/venv
      # - /app/.git
      # - /app/__pycache__
    # (Опционально) Устанавливаем переменные окружения
    environment:
      - PYTHONPATH=/app
    # (Опционально) Зависимости (если бы был, например, PostgreSQL)
    # depends_on:
    #   - db
    # (Опционально) Команда запуска (переопределяет CMD из Dockerfile)
    # command: uvicorn src.main:app --host 0.0.0.0 --port 8000

# Определяем том для хранения файлов
volumes:
  uploads_volume: # Имя тома
    # driver: local # Драйвер по умолчанию
    # driver_opts: # Опции драйвера (если нужно)
    #   type: none
    #   o: bind
    #   device: ./uploads_host # Пример привязки к локальной папке (не рекомендуется для продакшена)